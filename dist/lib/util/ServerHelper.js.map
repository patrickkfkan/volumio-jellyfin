{"version":3,"file":"ServerHelper.js","sourceRoot":"","sources":["../../../src/lib/util/ServerHelper.ts"],"names":[],"mappings":";;;;;AAAA,0CAAyC;AAEzC,yEAA0C;AAS1C,MAAqB,YAAY;IAE/B,MAAM,CAAC,oBAAoB;QACzB,OAAO,yBAAQ,CAAC,cAAc,CAAoB,SAAS,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;IACzE,CAAC;IAED,MAAM,CAAC,uBAAuB,CAAC,MAAc,EAAE,QAAgB;QAC7D,MAAM,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACtD,MAAM,UAAU,GAAG,iBAAiB,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,MAAM,CAAC,GAAG,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC;QAC3G,OAAO,UAAU,EAAE,QAAQ,IAAI,EAAE,CAAC;IACpC,CAAC;IAED,MAAM,CAAC,gBAAgB,CAAC,GAAW;QACjC,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;QAC5B,IAAI,MAAM,CAAC,QAAQ,KAAK,WAAW,IAAI,MAAM,CAAC,QAAQ,KAAK,WAAW,EAAE;YACtE,MAAM,YAAY,GAAG,IAAI,GAAG,CAAC,yBAAQ,CAAC,aAAa,EAAE,CAAC,IAAI,CAAC,CAAC;YAC5D,MAAM,CAAC,QAAQ,GAAG,YAAY,CAAC,QAAQ,CAAC;SACzC;QACD,MAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC;QACpC,IAAI,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;YAC3B,OAAO,SAAS,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SACrD;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;IAID,MAAM,CAAC,oBAAoB,CAAC,QAAgB,EAAE,YAA6B;QACzE,IAAI,OAAO,YAAY,KAAK,QAAQ,EAAE;YACpC,OAAO,GAAG,kBAAkB,CAAC,QAAQ,CAAC,IAAI,kBAAkB,CAAC,YAAY,CAAC,EAAE,CAAC;SAC9E;aACI,IAAI,OAAO,YAAY,KAAK,QAAQ,IAAI,YAAY,CAAC,IAAI,KAAK,qBAAU,CAAC,MAAM,EAAE;YACpF,OAAO,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,YAAY,CAAC,EAAE,CAAC,CAAC;SAC7D;QACD,MAAM,SAAS,CAAC,uFAAuF,CAAC,CAAC;IAC3G,CAAC;CACF;AApCD,+BAoCC","sourcesContent":["import { EntityType } from '../entities';\nimport Server from '../entities/Server';\nimport jellyfin from '../JellyfinContext';\n\n// An item in the `servers` array stored in plugin config.\nexport interface ServerConfEntry {\n  url: string;\n  username: string;\n  password: string;\n}\n\nexport default class ServerHelper {\n\n  static getServersFromConfig(): ServerConfEntry[] {\n    return jellyfin.getConfigValue<ServerConfEntry[]>('servers', [], true);\n  }\n\n  static fetchPasswordFromConfig(server: Server, username: string): string {\n    const serverConfEntries = this.getServersFromConfig();\n    const serverConf = serverConfEntries.find((conf) => conf.url === server.url && conf.username === username);\n    return serverConf?.password || '';\n  }\n\n  static getConnectionUrl(url: string): string {\n    const urlObj = new URL(url);\n    if (urlObj.hostname === 'localhost' || urlObj.hostname === '127.0.0.1') {\n      const deviceUrlObj = new URL(jellyfin.getDeviceInfo().host);\n      urlObj.hostname = deviceUrlObj.hostname;\n    }\n    const sanitized = urlObj.toString();\n    if (sanitized.endsWith('/')) {\n      return sanitized.substring(0, sanitized.length - 1);\n    }\n    return sanitized;\n  }\n\n  static generateConnectionId(username: string, serverId: string): string;\n  static generateConnectionId(username: string, server: Server): string;\n  static generateConnectionId(username: string, serverTarget: string | Server): string {\n    if (typeof serverTarget === 'string') {\n      return `${encodeURIComponent(username)}@${encodeURIComponent(serverTarget)}`;\n    }\n    else if (typeof serverTarget === 'object' && serverTarget.type === EntityType.Server) {\n      return this.generateConnectionId(username, serverTarget.id);\n    }\n    throw TypeError('serverTarget must be server Id (string) or object meeting Server interface constraint');\n  }\n}\n"]}